# Babylon.js Windmill Viewer Documentation

This document provides comprehensive documentation for the Babylon.js Windmill Viewer project. The application displays a 3D windmill model using Babylon.js and is served by a simple Express backend.

## Project Structure

```
/Users/frederic/fax/src/proto/babylon-js-windmill
├── dist/
│   ├── client/         # Frontend build output from Vite
│   │   ├── assets/
│   │   └── ...
│   └── server.js       # Backend build output from tsc
├── docs/
│   └── README.md
├── node_modules/
├── src/
│   ├── app.ts
│   └── server.ts
├── assets/
│   └── windmill.glb  # Example asset, confirm actual asset paths
├── index.html
├── package.json
├── package-lock.json
├── tsconfig.json
├── tsconfig.server.json # Separate tsconfig for server build
├── vite.config.ts       # Vite configuration file
└── .env               # Optional: for environment variables like PORT
```

- **dist/**: Contains the build output.
  - `client/`: Bundled frontend assets generated by Vite.
  - `server.js`: Compiled backend code generated by `tsc`.
- **docs/**: Contains project documentation.
- **node_modules/**: Contains project dependencies.
- **src/**: Contains the TypeScript source code.
  - `app.ts`: Frontend Babylon.js application logic.
  - `server.ts`: Backend Express server logic.
- **assets/**: Contains 3D models and other static assets.
- `index.html`: The main HTML file that loads the Babylon.js canvas and application script.
- `package.json`: Lists project dependencies and scripts.
- `package-lock.json`: Records exact versions of dependencies.
- `tsconfig.json`: Base TypeScript compiler configuration (primarily for type checking & Vite).
- `tsconfig.server.json`: TypeScript compiler configuration specifically for the backend server build.
- `vite.config.ts`: Vite bundler configuration for the frontend.
- `.env` (Optional): Environment variables (e.g., `PORT=8080`).

## Setup Instructions

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd babylon-js-windmill
    ```
2.  **Install dependencies:**
    ```bash
    npm install
    ```

## Build and Run Commands

-   **Run the development server:** Starts the Vite dev server for the frontend (port 3000 by default, opens browser) and the Node.js backend server (port 8080 by default) concurrently using `nodemon` for auto-restarts.
    ```bash
    npm run dev
    ```
    *Frontend is accessible via the port specified in `vite.config.ts` (default 3000).* 
    *Backend serves static files and API (if any) via the port specified in `.env` or `src/server.ts` (default 8080).* 

-   **Build the project:** Compiles and bundles the frontend using Vite and compiles the backend using `tsc`.
    ```bash
    npm run build
    ```
    This runs two sub-commands:
    - `npm run build:client` (uses `vite build`)
    - `npm run build:server` (uses `tsc -p tsconfig.server.json`)

-   **Start the production server:** Runs the compiled backend server code, which serves the built frontend assets.
    ```bash
    npm start
    ```
    Access the application in your browser, typically at `http://localhost:8080` (or the port specified in `.env` or the default in `server.ts`).

## Code Explanation

### `src/app.ts`

This file contains the client-side code responsible for rendering the 3D scene using Babylon.js.

-   **Initialization**: Sets up the Babylon.js engine and scene, attaching it to the HTML canvas element (`#renderCanvas`).
-   **Camera**: Configures an `ArcRotateCamera` for user interaction (orbiting, zooming).
-   **Lighting**: Adds a `HemisphericLight` to illuminate the scene.
-   **Model Loading**: Uses `SceneLoader` to import the windmill model (e.g., `windmill.glb`) from the `/assets` directory and adds it to the scene.
-   **Render Loop**: Starts the engine's render loop to continuously draw the scene.

### `src/server.ts`

This file sets up a simple backend server using Express.js.

-   **Dependencies**: Imports `express` and `path`.
-   **Middleware**: Uses `express.static` to serve static files from the project root (including `index.html`, bundled JS, and assets).
-   **Environment Variables**: Optionally uses `dotenv` to load environment variables (like `PORT`) from a `.env` file.
-   **Port Configuration**: Sets the server port, defaulting to 8000 if `process.env.PORT` is not set.
-   **Server Start**: Starts the Express server and logs the listening address.

## Dependencies

### Production Dependencies

-   `@babylonjs/core`: Core Babylon.js library for 3D rendering.
-   `@babylonjs/loaders`: Babylon.js loaders for various 3D model formats (e.g., glTF/GLB).
-   `express`: Web framework for the backend server.
-   `dotenv`: Loads environment variables from a `.env` file.

### Development Dependencies

-   `typescript`: TypeScript compiler.
-   `@types/express`: Type definitions for Express.
-   `@types/node`: Type definitions for Node.js.
-   `vite`: Fast frontend build tool and development server.
-   `ts-node`: Execute TypeScript files directly in Node.js (used for backend dev server).
-   `nodemon`: Utility that automatically restarts the server during development when file changes are detected.
-   `concurrently`: Runs multiple commands concurrently (used in `npm run dev`).

## Future Development

This project serves as a foundation. Future enhancements could include:

-   Adding more complex interactions or animations to the windmill.
-   Implementing unit or integration tests.
-   Setting up a more robust deployment pipeline.
-   Improving error handling and logging.

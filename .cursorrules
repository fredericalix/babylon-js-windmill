# Babylon.js Windmill Project - Development Guidelines

## ğŸ¯ Project Overview
This is a 3D web application using Babylon.js to display and interact with a windmill model on a hexagonal island. The project should follow modern web development best practices with a focus on maintainability, performance, and user experience.

## ğŸŒ Language Requirements
- **ALL code, comments, and documentation MUST be written in English**
- Use clear, descriptive names that explain the purpose
- Avoid abbreviations unless they are well-known (e.g., DOM, API, 3D)

## ğŸ—ï¸ Architecture Principles

### Single Responsibility Principle (SRP)
Every module, class, and function should have ONE clear responsibility:
- **Modules**: One feature or domain per module
- **Classes**: One concept per class
- **Functions**: One task per function, max 20-30 lines
- **Files**: One main export per file

### Project Structure
```
src/
â”œâ”€â”€ core/              # Core engine and scene management
â”‚   â”œâ”€â”€ Engine.ts      # Babylon.js engine initialization
â”‚   â”œâ”€â”€ Scene.ts       # Scene setup and configuration
â”‚   â””â”€â”€ Camera.ts      # Camera controls and management
â”œâ”€â”€ models/            # 3D model loading and management
â”‚   â”œâ”€â”€ ModelLoader.ts # Generic model loading utilities
â”‚   â”œâ”€â”€ Windmill.ts    # Windmill-specific logic
â”‚   â””â”€â”€ Terrain.ts     # Hexagonal terrain management
â”œâ”€â”€ controls/          # User input and interactions
â”‚   â”œâ”€â”€ KeyboardControls.ts
â”‚   â”œâ”€â”€ MouseControls.ts
â”‚   â””â”€â”€ UIControls.ts
â”œâ”€â”€ animations/        # Animation systems
â”‚   â”œâ”€â”€ FanRotation.ts
â”‚   â””â”€â”€ Construction.ts
â”œâ”€â”€ utils/             # Utility functions
â”‚   â”œâ”€â”€ hexGrid.ts     # Hexagonal grid calculations
â”‚   â””â”€â”€ logger.ts      # Logging utilities
â””â”€â”€ app.ts            # Application entry point
```

## ğŸ“ Code Style Guidelines

### TypeScript Best Practices
```typescript
// âœ… Good: Clear interface with single responsibility
interface WindmillConfig {
  position: Vector3;
  scale: number;
  rotationSpeed: number;
}

// âœ… Good: Single responsibility class
class WindmillController {
  private mesh: AbstractMesh;
  private isRotating: boolean = false;
  
  constructor(private config: WindmillConfig) {}
  
  public startRotation(): void {
    this.isRotating = true;
  }
  
  public stopRotation(): void {
    this.isRotating = false;
  }
}

// âŒ Bad: Multiple responsibilities in one class
class WindmillAndTerrainAndCamera {
  // Too many responsibilities!
}
```

### Babylon.js Specific Guidelines
1. **Scene Management**
   - Separate scene creation from model loading
   - Use async/await for all asset loading
   - Implement proper disposal methods

2. **Performance Optimization**
   - Use instanced meshes for repeated objects
   - Implement LOD (Level of Detail) for complex models
   - Optimize texture sizes and formats
   - Use mesh merging for static geometry

3. **Asset Loading**
   ```typescript
   // âœ… Good: Proper async loading with error handling
   async function loadWindmill(scene: Scene): Promise<WindmillModel> {
     try {
       const result = await SceneLoader.ImportMeshAsync(
         "",
         "assets/",
         "building_windmill_blue.gltf",
         scene
       );
       return new WindmillModel(result.meshes);
     } catch (error) {
       logger.error("Failed to load windmill model", error);
       throw new ModelLoadError("Windmill loading failed");
     }
   }
   ```

## ğŸ§ª Testing Requirements
- Write unit tests for utility functions
- Integration tests for model loading
- E2E tests for user interactions
- Minimum 80% code coverage

## ğŸ“š Documentation Standards
```typescript
/**
 * Calculates the position of a hexagon in a hexagonal grid
 * @param q - The column coordinate in axial system
 * @param r - The row coordinate in axial system
 * @param size - The size of each hexagon
 * @param height - The vertical offset from ground
 * @returns The 3D position vector for the hexagon
 * @see https://www.redblobgames.com/grids/hexagons/
 */
function getHexPosition(q: number, r: number, size: number, height: number): Vector3 {
  // Implementation
}
```

## ğŸ”„ Basic Memory Integration
- **Regular updates**: Update the basic-memory project documentation after each significant change
- **Decision tracking**: Document all architectural decisions in ADR format
- **Knowledge capture**: Store implementation insights and lessons learned

### Update Schedule
- Daily: Quick notes on progress and blockers
- Weekly: Architecture decisions and design changes
- Per feature: Complete documentation of new features

## ğŸ® 3D Application Best Practices

### Camera Controls
- Implement smooth camera movements with inertia
- Provide both keyboard and mouse controls
- Add boundary limits to prevent disorientation
- Include reset view functionality

### User Feedback
- Visual indicators for interactive elements
- Smooth transitions for all animations
- Loading indicators for asset loading
- Error messages for failed operations

### Mobile Optimization
- Touch controls for camera movement
- Responsive UI elements
- Performance scaling based on device capabilities
- Reduced polygon count for mobile devices

## ğŸš€ Performance Guidelines
1. **Rendering Optimization**
   - Use frustum culling
   - Implement occlusion culling for complex scenes
   - Batch draw calls where possible
   - Use texture atlases

2. **Memory Management**
   - Dispose of unused meshes and textures
   - Implement resource pooling for frequently created objects
   - Monitor memory usage in development

3. **Animation Performance**
   - Use GPU-based animations where possible
   - Limit the number of concurrent animations
   - Implement animation LOD

## ğŸ› ï¸ Development Workflow
1. **Before coding**: Check basic-memory for existing patterns and decisions
2. **During coding**: Follow SRP and create small, focused commits
3. **After coding**: Update documentation and basic-memory notes
4. **Code review**: Verify SRP compliance and English documentation

## ğŸ“‹ Commit Message Format
```
feat(windmill): Add fan rotation control
- Implement keyboard toggle for fan rotation
- Add visual feedback for rotation state
- Update control instructions in UI

Closes #123
```

## ğŸ¯ Project-Specific Rules
1. **Hexagonal Grid**: All terrain calculations must use the axial coordinate system
2. **Asset Pipeline**: All 3D models must be optimized before inclusion (max 100k polygons)
3. **Animations**: All animations must be interruptible and reversible
4. **Controls**: All controls must work with both keyboard and UI buttons

## ğŸ” Code Review Checklist
- [ ] All code and comments are in English
- [ ] Each file has a single, clear responsibility
- [ ] Functions are under 30 lines
- [ ] Proper error handling is implemented
- [ ] Performance implications are considered
- [ ] Documentation is complete and clear
- [ ] Basic-memory is updated if needed

## ğŸ“š Recommended Resources
- [Babylon.js Best Practices](https://doc.babylonjs.com/guidedLearning/practicaltips)
- [Red Blob Games - Hexagonal Grids](https://www.redblobgames.com/grids/hexagons/)
- [Clean Code Principles](https://github.com/ryanmcdermott/clean-code-javascript)
- [TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html) 